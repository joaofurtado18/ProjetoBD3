% #############################################################################    % This is the MAIN DOCUMENT of the IST-UL-Project-Report TEMPLATE. 
% !TEX root = ./main.tex
% #############################################################################
% The document is automatically set for english or portuguese by just selecting
% the MAIN LANGUAGE in file 'IST-UL-Project-Report-Preamble.tex' 
% #############################################################################
% Version 1.0, October 2018
% BY: Prof. Rui Santos Cruz, rui.s.cruz@tecnico.ulisboa.pt
% #############################################################################
% Set the document class
% ----------------------------------------------------------------------
\documentclass[12pt,a4paper]{report}
\usepackage{latexsym}

% -----------------------------------------------------------------------------
% The Preamble document contains all the necessary Packages for typesetting
% Modify it to suit your needs
% -----------------------------------------------------------------------------
\input{./IST-UL-Project-Report-Preamble}


% \newglossaryentry{ic1}{name=IC-1, description={oordinated Uiersal Time}}

% \newglossaryentry{ic2}{name=IC-2, description={ordinatedUniversal Time}}

% \newglossaryentry{ic3}{name=IC-3, description={oordinatedUnivrsal Time}}

% \newglossaryentry{ic4}{name=IC-4, description={oordinatd Uiversal Time}}

% \newglossaryentry{ic5}{name=IC-5, description={oordinaed Universal Time}}

% \newglossaryentry{ic6}{name=IC-6, description={oordinated Universal Time}}

% \newglossaryentry{ic7}{name=IC-7, description={oordinted Univeral Time}}

% \newglossaryentry{ic8}{name=IC-8, description={oordinated Univeral Time}}

% \newglossaryentry{ic9}{name=IC-9, description={oordinated Universal Time}}

% \makenoidxglossaries



% \newglossaryentry{maths}
% {
% name=mathematics,
% description={Mathematics is what mathematicians do}
% }

%   \newglossaryentry{latex}
%   {
%   name=latex,
%   description={Is a markup language specially suited for 
%   scientific documents}
% }


%   \newglossaryentry{formula}
%   {
%   name=formula,
%   description={A mathematical expression}
% }
%   #############################################################################
\begin{document}



% Set plain page style (no headers, footer with centered page number)
\pagestyle{plain}
% Set roman numbering (i,ii,...) before the start of chapters
\pagenumbering{roman}
% ----------------------------------------------------------------------------
% Cover page
\input{IST-UL-Project-Report-Front_Cover}
\cleardoublepage
% ----------------------------------------------------------------------------
% Table of contents, list of tables, list of figures and nomenclature
% ----------------------------------------------------------------------------
% Set arabic numbering (1,2,...) after preface
\setcounter{page}{1}
\pagenumbering{arabic}
% #############################################################################
% 
% BEGIN MAIN DOCUMENT BODY
% 
% #############################################################################

% \section*{Entity-Association Modelation}

% \begin{figure}[htpb]
%   \centering
%   \includegraphics[width=1.0\textwidth]{./pictures/cona.pdf} 
%   \caption{The modelation of the problem, regarding the Entity-Association modelation's theory.}.
% \end{figure}

% % \gls

% % \printnoidxglossaries
% \subsection*{Integrity Constraints}

% \begin{itemize}
% \item (IC-1) A Category cannot be contained in itself.

% \item (IC-2) Cannot exist cycles on the hierarchy of Categories.

% \item (IC-3) The name of the Retailer is unique.

% \item (IC-4) The number of units replenished in a singular event of Replenishement cannot exceed the number of units specified on the Planogram.

% \item (IC-5) A Product can only be replenished in a Shelf where its category is noted.

% \item (IC-6) A Product can only be replenished by the Retailer responsible by Products's category.

% \end{itemize}

\section*{Relational Model}

\begin{itemize}
  
\item point\_of\_retail(\underline{address}, name).

\item IVM(\underline{serial\_number}, \underline{manuf})
  
\item product(\underline{EAN}, descr)
  \begin{itemize}
  \item shelf(\underline{serial\_number}, \underline{manuf}, \underline{nr}, height)
  \item serial\_number: FK(IVM)
  \item manuf: FK(IVM)
  \end{itemize}

\item ambient\_temp\_shelf(\underline{nr})
  \begin{itemize}
  \item nr: FK(shelf)
  \end{itemize}

\item warm\_shelf(\underline{nr})
  \begin{itemize}
  \item nr: FK(shelf)
  \end{itemize}
  
\item cold\_shelf(\underline{nr})
  \begin{itemize}
  \item nr: FK(shelf)
  \end{itemize}

\item category(\underline{name})
  
\item simple\_category(\underline{name})
  \begin{itemize}
  \item name: FK(shelf)
  \end{itemize}

\item super\_category(\underline{name})
  \begin{itemize}
  \item name: FK(shelf)
  \end{itemize}

\item retailer(\underline{TIN}, name)
  \begin{itemize}
  \item UNIQUE(name)
  \end{itemize}
  
\item replenishment\_event(\underline{instant}, units)
  
\item installed-at(address, \underline{serial\_number}, \underline{manuf}, nr)
  \begin{itemize}
  \item address: FK(point\_of\_retail)
  \item serial\_number: FK(IVM)
  \item manuf: FK(IVM)
    \end{itemize}

\item replenisher\_of(\underline{TIN}, \underline{instant})
  \begin{itemize}
  \item TIN: FK(retailer)
  \item instant: FK(replenishment\_event)
  \end{itemize}
  
\item replenishment(\underline{instant}, \underline{EAN}, \underline{nr})
  \begin{itemize}
  \item instant: FK(replenishment\_event)
  \item EAN: FK(planogram.EAN, planogram.nr)
  \item nr: FK(planogram.EAN, planogram.nr)
  \end{itemize}
  
\item has(\underline{EAN}, \underline{name})
  \begin{itemize}
  \item EAN: FK(product)
  \item name: FK(category)
    \end{itemize}


\item planogram(\underline{EAN}, \underline{nr}, faces, units, loc)

\item responsable\_for(\underline{name}, \underline{TIN}, \underline{serial\_number}, \underline{manuf})
  \begin{itemize}
  \item name: FK(category)
  \item TIN: FK(retailer)
  \item serial\_number: FK(IVM)
  \item manuf: FK(IVM)
  \end{itemize}
  
\item displayed(\underline{name}, \underline{nr})
  \begin{itemize}
  \item name: FK(category)
  \item nr: FK(category)
  \end{itemize}

\item of(\underline{nr}, \underline{serial\_number}, \underline{manuf})
  \begin{itemize}
  \item nr: FK(shelf)
  \item serial\_number: FK(IVM)
  \item manuf: FK(IVM)
  \end{itemize}

\item has-other(\underline{category\_name}, \underline{super\_category\_name})
  \begin{itemize}
  \item category\_name: FK(category.name)
  \item super\_category\_name: FK(category.name)
  \end{itemize}

\end{itemize}
% \item (IC-1) A Category cannot be contained in itself.

% \item (IC-2) Cannot exist cycles in the hierarchy of Categories.

% \item (IC-3) The name of the Retailer is unique.

% \item (IC-4) The number of units replenished in a singular event of Replenishement cannot exceed the number of units specified on the Planogram. The number of units from Replenishment event is always less or equal than the number of units in the Planogram.

% \item (IC-5) A Product can only be replenished in a Shelf where its category is noted.

% \item (IC-6) A Product can only be replenished by the Retailer responsible by Products's category.

\section*{Integrity Constraints}
\subsection*{Relational Model}
\begin{itemize}
\item (IC-1): category\_name is always different from super\_category\_name.
\item (IC-2): Cannot exist cycles in the hierarchy of Categories.
\item (IC-3): The number of units replenished in a singular event of Replenishement cannot exceed the number of units specified on the Planogram.
\item (IC-4): A Product can only be replenished in a Shelf where its category is noted.
\item (IC-5): A Product can only be replenished by the Retailer responsible by Products's category.
\item (IC-6): A name can only exist in simple\_category or super\_category.
\item (IC-7): Every product (EAN) must participate in the has associaton.
\item (IC-8): EAN can only exist in ambient\_temp\_shelf, warm\_shelf or cold\_shelf.
\end{itemize}



\section*{Relational Algebra}
\begin{enumerate}
\item[1.] $\pi_{EAN, designacao}(\sigma_{name = "Barras\ de\ Energetico" \land  instant > "2021/12/31" \land units > 10 }(Product \Join Replenishment Event))$
\item[2.] $\pi_{serial\_number}(\sigma_{EAN = 9002490100070})((Products \Join Planogram)\Join of)$
\item[3.] $G_{count}() \rightarrow_{c(has-other)}(\sigma_{name = "SopasTake-Away"}(category))$
\item[4.] $prods \leftarrow _{EAN, Designacao}G_{count() \rightarrow c(replenishment)}$ \\
  $result \leftarrow G_{max(c)}(prods) \Join prods$
\end{enumerate}

\section*{SQL}
\begin{enumerate}
\item[1.]
\begin{verbatim}
SELECT ean, descr
    FROM product NATURAL JOIN Replenishment_Event
    WHERE name = "Barras de EnergÃ©tico"
        AND instant > "2021/12/31"
        AND units > 10;
\end{verbatim}
\item[2.]
\begin{verbatim}
SELECT serial_number
    FROM Products NATURAL JOIN Planogram NATURAL JOIN of
    WHERE ean = 9002490100070; 
\end{verbatim}

\item[3.]
\begin{verbatim}
SELECT COUNT(category_name)
    FROM has-other
    WHERE super_category_name = "SopasTake-Away";
\end{verbatim}

\item[4.]
  \begin{verbatim}
SELECT ean, descr
FROM (
    SELECT ean, descr, COUNT(instant)
    FROM product NATURAL JOIN replenishment
    GROUP BY ean, descr
) AS table
WHERE count >= ALL (
    SELECT count
    FROM table
);
    

\end{verbatim}
\end{enumerate}
\end{document}